# Overview

上一篇有提到API設計和Database拿資料，但沒有太深入講到Database這塊，這篇就來說明Java如何連接資料庫和搜尋資料等操作。

## 使用 JDBC 資料庫連接/操作

### JDBC 簡介

JDBC（Java Database Connectivity）是一個Java API，用於連接和執行查詢數據庫。

### JDBC 使用步驟

1. JDBC Driver
	```java
	Class.forName("com.mysql.cj.jdbc.Driver");
	```
2. 連接資料庫
	```java
	private static final String url = "jdbc:mysql://xxx/tableName";
    private static final String username = DB_name;
    private static final String password = DB_pwd;
	
	Connection conn = DriverManager.getConnection(url, username, password);
	```
3. 創建和執行SQL語法，從ResultSet察看結果
	- 使用"PreparedStatement"執行SQL查詢
	```java
	PreparedStatement stmt = conn.prepareStatement(sql)
	ResultSet rs = stmt.executeQuery();
	```
4. 關閉資源
	- 使用try-with-resources語法時，不需要關閉Connection對象。try-with-resources會自動關閉Connection。即使在try裡面發生異常也會自動關閉。
	```sql
	try (Connection conn = DriverManager.getConnection(url, username, password)) {
        ...
    } catch (SQLException e) {
        ...
    }
	```
	
### SQL 注入攻擊

透過惡意插入惡意的SQL語句輸入到字串中，會改變原有SQL語法預期的操作。  
可能會導致資料庫中數據被破壞。  

**SQL注入的例子，不要這樣寫!**
``` java
String email = xxx@mail;
String sql = "SELECT Username, Password FROM Users WHERE Email = '" + email + "'";
```
如果被改成這樣，查詢就總是為true，可能會導致數據被惡意拿取等等。
```sql
SELECT Username, Password FROM Users WHERE Email = '' OR '1'='1'
```

### 使用 PreparedStatement 防止SQL注入

```java
String sql = "SELECT Username, Password FROM Users WHERE Email = ?";
try (PreparedStatement stmt = conn.prepareStatement(sql)) {
    stmt.setString(1, email);
    ResultSet rs = stmt.executeQuery();
    ...
}
```
- 防止SQL注入：因為"PreparedStatement"將SQL語句與參數分開處理，因此輸入了惡意數據，也不會改變SQL語句結構。
- 提高可讀性：有多個參數時，可以更容易讀和理解。

	