# Overview

在後端開發中，安全性和身分驗證是很重要的。這篇將介紹如何使用 JWT (JSON Web Token) 進行加密驗證。

## 後端 (Java Spring Boot) 安全性

### 安全性和身分驗證

前端登入成功之後，後端會產生一個 Token 給前端。前端在之後的API操作只要附上 Token ，後端會驗證Token是否合法。

### JWT Token 加密驗證

JWT 是一種開放標準 (RFC 7519)，它定義了一種緊湊且獨立的方式，用於在各方之間作為 JSON 對象安全地傳輸信息。  
JWT 使用簽名 (HMAC 或 RSA) 來確保 token 的完整性和真實性。只有持有正確密鑰的服務才能生成有效的 JWT，防止了 token 被篡改或偽造。
 - JWT 的結構簡單由三個部分組成：
	Header、Payload、Signature。

#### JWT 範例

先定義條件，"SECRET_KEY"可以帶入自己的編碼例如：Base64編碼密鑰。  
設置簽名的加密算法 HMAC256 和過期時間。
```java
    private static final String SECRET_KEY = "xxxxx";
    private static final Algorithm ALGORITHM = Algorithm.HMAC256(SECRET_KEY);
    private static final long EXPIRATION_TIME = 7 * 24 * 60 * 60 * 1000; // 7 days
```

1. 產生JWT
 - 將你要的資訊加密到 Token 裡面，額外資訊可以透過 Payload 儲存。
 ```java
	public static String generateToken(String userName, String email) {
        Map<String, String> claims = new HashMap<>();
        claims.put("userName", userName);

        return JWT.create()
                .withSubject(email)
                .withPayload(claims)
                .withExpiresAt(new Date(System.currentTimeMillis() + EXPIRATION_TIME))
                .sign(ALGORITHM);
    }
 ```
2. 驗證JWT
 - 從前端拿到的 Token，來驗證是否合法。使用相同的"ALGORITHM"驗證 Token。
 ```java
    public static DecodedJWT verifyToken(String token) {
        try {
            JWTVerifier verifier = JWT.require(ALGORITHM).build();
            return verifier.verify(token);
        } catch (JWTVerificationException e) {
            System.err.println("JWT verification failed: " + e.getMessage());
            return null;
        }
    }
 ```
3. 從Token中獲得訊息
  - 驗證成功之後，可以獲取加密在 Token 裡面的訊息。  
  獲取"Subject"裡面的資訊"email"。
  ```java
    public static String getEmailFromToken(String token) {
        DecodedJWT jwt = verifyToken(token);
        return jwt != null ? jwt.getSubject() : null;
    }
  ```
   獲取"Payload"裡面資訊
  ```java
	public static String getUserNameFromToken(String token) {
        return getClaimFromToken(token, "userName");
    }
	private static String getClaimFromToken(String token, String claimName) {
        DecodedJWT jwt = verifyToken(token);
        if (jwt != null) {
            Claim claim = jwt.getClaim(claimName);
            return claim.isNull() ? null : claim.asString();
        }
        return null;
    }
  ```
 